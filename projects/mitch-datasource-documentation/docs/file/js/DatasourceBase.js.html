<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">js/DatasourceBase.js | mitch-datasource-documentation</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Documentation for mitch-datasource"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="mitch-datasource-documentation"><meta property="twitter:description" content="Documentation for mitch-datasource"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/deltoss/mitch-datasource"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/AjaxDatasource.js~AjaxDatasource.html">AjaxDatasource</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/ArrayDatasource.js~ArrayDatasource.html">ArrayDatasource</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/DatasourceBase.js~DatasourceBase.html">DatasourceBase</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/QueryBuilder.js~QueryBuilder.html">QueryBuilder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-SortCallback">SortCallback</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-SortCallback">SortCallback</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MultiColumnSearchArgs">MultiColumnSearchArgs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MultiColumnSortArgs">MultiColumnSortArgs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-QueryStringOptions">QueryStringOptions</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-SerialiseToQueryObjectCallback">SerialiseToQueryObjectCallback</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-SerialiseToQueryStringCallback">SerialiseToQueryStringCallback</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">js/DatasourceBase.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import EventEmitter from &apos;events&apos;;

/**
 * An abstract class for derived datasource
 * classes to use to represent core collections
 * of data.
 *
 * It provides additional features such
 * as pagination, sorting, searching, etc.
 */
class DatasourceBase extends EventEmitter {
  /**
   * The object used for multi-column or
   * specific-column searching. It should be
   * in the format of:
   * ```
   * {
   *   &apos;[fieldNameToSearch1]&apos;: &apos;[textToSearch]&apos;,
   *   // ...
   *   &apos;[fieldNameToSearchN]&apos;: &apos;[textToSearch]&apos;
   * }
   * ```
   *
   * @typedef {Object} MultiColumnSearchArgs
   * @example
   * {
   *    &apos;firstName&apos;: &apos;michael&apos;,
   *    &apos;lastName&apos;: &apos;jackson&apos;
   * }
   */

  /**
   * The object used for multi-column or
   * specific-column sorting. It should be
   * in the format of:
   * ```
   * {
   *   &apos;[fieldNameToSort1]&apos;: &apos;[desc|descend|descending|asc|ascend|ascending]&apos;,
   *   // ...
   *   &apos;[fieldNameToSortN]&apos;: &apos;[desc|descend|descending|asc|ascend|ascending]&apos;
   * }
   * ```
   *
   * @typedef {Object} MultiColumnSortArgs
   * @example
   * {
   *    &apos;firstName&apos;: &apos;asc&apos;,
   *    &apos;lastName&apos;: &apos;desc&apos;
   * }
   */

  /**
   * Create a datasource.
   * @param {Object} [options]
   * The datasource options.
   * @param {Boolean} [options.loading=false]
   * Represents whether the datasource is
   * loading or not.
   * @param {Number} [options.offset=0]
   * The pagination offset. It skips the
   * specified amount of items when querying.
   * @param {Number} [options.page=1]
   * The page number for data pagination.
   * @param {Number} [options.size=10]
   * The pagination size, i.e. the number
   * of records per page.
   * @param {String} [options.searchText=null]
   * The text to search for. Used to filter
   * the data items.
   * @param {MultiColumnSearchArgs} [options.searchArguments=null]
   * The search arguments object, for specific
   * or multi-column searching purposes.
   * @param {MultiColumnSortArgs} [options.sortArguments=null]
   * The sort arguments object, for specific
   * or multi-column sorting purposes.
   */
  constructor(options = {}) {
    super();
    const mergedOptions = {
      ...DatasourceBase.prototype.defaults,
      ...options,
    };

    /**
     * Represents whether the datasource is
     * loading or not.
     *
     * @access public
     * @type {Boolean}
     */
    this.loading = mergedOptions.loading;

    /**
     * The pagination offset. It skips the
     * specified amount of items when querying.
     *
     * @access public
     * @type {Number}
     */
    this.offset = mergedOptions.offset;

    /**
     * The pagination size, i.e. the number
     * of records per page.
     *
     * @access public
     * @type {Number}
     */
    this.size = mergedOptions.size;

    /**
     * The text to search for. Used to filter
     * the data items.
     *
     * @access public
     * @type {String}
     */
    this.searchText = mergedOptions.searchText;

    /**
     * The search arguments object, for specific
     * or multi-column searching purposes.
     *
     * @access public
     * @type {MultiColumnSearchArgs}
     */
    this.searchArguments = mergedOptions.searchArguments;

    /**
     * The search arguments object, for specific
     * or multi-column sorting purposes.
     *
     * @access public
     * @type {MultiColumnSortArgs}
     */
    this.sortArguments = mergedOptions.sortArguments;

    if (mergedOptions.page) {
      /**
       * The page number for data pagination.
       *
       * @access public
       * @type {Number}
       */
      this.page = mergedOptions.page;
    }
  }

  /**
   * Overridables
   */

  /**
   * Gets the current set of data the datasource
   * has, based on pagination, sorting, and filtering.
   * @abstract
   * @access public
   * @type {?Array}
   */
  get data() {
    throw new Error(`Getter not supported for ${this.constructor.name}`);
  }

  /**
   * Gets the total amount of data items available
   * for the datasource to page through.
   * @abstract
   * @type {Number}
   */
  get total() {
    throw new Error(`Getter not supported for ${this.constructor.name}`);
  }

  /**
   * Updates the datasource, using the currently
   * configured search text, sort settings, and
   * pagination options.
   * @abstract
   * @access protected
   * @return {Promise} A promise object, resolved when the update is completed.
   */
  _update() {
    throw new Error(`Method not supported for ${this.constructor.name}`);
  }

  /**
   * Getters &amp; Setters
   */

  /**
   * Gets the total amount of data items for the current page.
   * @access public
   * @type {?Array}
   */
  get pageTotal() {
    if (this.offset === this.total) {
      return 0;
    }
    const itemsRemaining = this.total - this.offset;
    if (itemsRemaining &lt;= this.size) {
      return itemsRemaining;
    }
    return this.size;
  }

  /**
   * Gets the current page the datasource is
   * currently set to.
   * @access public
   * @type {Number}
   */
  get page() {
    if (this.totalPages === 0) {
      return 0;
    }
    return (this.offset + this.size) / this.size;
  }

  /**
   * @param {Number} newPage - The new page to set to.
   * @access public
   * @type {Number}
   */
  set page(newPage) {
    this.offset = newPage * this.size - this.size;
  }

  /**
   * Boolean to indicate whether it&apos;s the first page or not.
   * @access public
   * @type {Boolean}
   */
  get isFirstPage() {
    if (this.page &lt;= 1) {
      return true;
    }
    return false;
  }

  /**
   * Boolean to indicate whether it&apos;s the last page or not.
   * @access public
   * @type {Boolean}
   */
  get isLastPage() {
    if (this.page &gt;= this.totalPages) {
      return true;
    }
    return false;
  }

  /**
   * The total amount of pages.
   * Returns null if total wasn&apos;t provided.
   * A number representing current page otherwise.
   * @access public
   * @type {?Number}
   */
  get totalPages() {
    if (this.total === null || !this.size) {
      return null;
    }
    if (this.total === 0) {
      return 0;
    }
    return Math.ceil(this.total / this.size);
  }

  /**
   * Methods
   */

  /**
   * Updates the datasource, using the currently
   * configured search text, sort settings, and
   * pagination options.
   * @access public
   * @return {Promise} A promise object, resolved when the update is completed.
   */
  async update() {
    this.loading = true;
    try {
      const updateStartArgs = {
        sender: this,
        prevented: false,
        preventDefault() {
          updateStartArgs.prevented = true;
        },
      };
      this.emit(&apos;updatestart&apos;, updateStartArgs);
      if (updateStartArgs.prevented) {
        return null;
      }
      const updatedResponse = await this._update();
      this.loading = false;
      this.emit(&apos;updateend&apos;, {
        sender: this,
        response: updatedResponse,
      });
      return updatedResponse;
    } catch (ex) {
      this.loading = false;
      throw ex;
    }
  }

  /**
   * Traverse to the specified page, and update the datasource accordingly.
   * @access public
   * @param  {Number} pageNum - The new page to traverse to.
   * @return {Promise} A promise with a boolean data. True if
   *                   successfully traversed to specified page.
   *                   False otherwise.
   */
  async goToPage(pageNum) {
    if (pageNum &gt; 0 &amp;&amp; pageNum &lt;= this.totalPages) {
      this.page = pageNum;
      await this.update();
      return true;
    }
    return false;
  }

  /**
   * Traverse to the next page, and update the datasource accordingly.
   * @return {Promise} A promise with a boolean data. True if
   *                   successfully traversed to next page.
   *                   False otherwise.
   */
  async nextPage() {
    return this.goToPage(this.page + 1);
  }

  /**
   * Traverse to the previous page, and update the datasource accordingly.
   * @access public
   * @return {Promise} A promise with a boolean data. True if
   *                   successfully traversed to previous page.
   *                   False otherwise.
   */
  async prevPage() {
    return this.goToPage(this.page - 1);
  }

  /**
   * Given a search text, filters the data accordingly.
   * @access public
   * @param  {String} searchArguments - The search text to filter with, or
   *                                    the search arguments object to filter
   *                                    with specific column filtering.
   * @return {Promise} A promise object, resolved when the search is completed.
   */
  async search(searchArguments) {
    this.searchText = null;
    this.searchArguments = null;
    if (typeof searchArguments === &apos;string&apos;) {
      this.searchText = searchArguments;
    } else {
      this.searchArguments = searchArguments;
    }
    this.offset = 0;
    return this.update();
  }

  /**
   * Sort the data based on a field and direction.
   * @access public
   * @param  {Object} sortArguments - Object with keys as the field names to sort.
   *                                  The values of the object is the sort direction.
   *                                  The sort direction can be &apos;asc&apos;, &apos;ascend&apos;, &apos;desc&apos;,
   *                                  &apos;descending&apos;
   * @return {Promise} A promise object, resolved when the sorting is completed.
   */
  async sort(sortArguments = null) {
    this.sortArguments = sortArguments;
    return this.update();
  }
}

DatasourceBase.prototype.defaults = {
  loading: false,
  offset: 0,
  size: 10,
  searchText: null,
  searchArguments: null,
  sortArguments: null,
};

export default DatasourceBase;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
